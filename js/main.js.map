{"version":3,"file":"main.js","sources":["../src/js/main.js"],"sourcesContent":["/**\n * Main application\n *\n */\n\nclass Main {\n  constructor() {\n    this.init();\n  }\n\n  init() {\n    this.csv = [];\n    this.metaKeys = [ [ 'post_title', 'Last Name'], ['first_name', 'First Name'], ['job_title', 'Job Title'], ['company_name', 'Company Name'], ['email', 'Email'], ['phone', 'Phone'], ['session_title', 'Session Title'], ['session_abstract', 'Session Abstract'], ['post_content', 'Bio'] ];\n    this.initUploadListener();\n  }\n\n  /**\n   * handle file upload select\n   */\n  initUploadListener() {\n    var inputElement = document.getElementById(\"file-input\");\n    inputElement.addEventListener(\"change\", (event) => this.handleFiles(event), true);\n  }\n\n  handleFiles(e) {\n    var file = e.target.files[0];\n    var reader = new FileReader();\n    reader.readAsText(file);\n    reader.onloadend = ()=> {\n      this.xmlString = reader.result;\n      this.createCSV();\n      this.saveCSV();\n      this.showOutput();\n    };\n  }\n\n  createCSV() {\n    this.createTitles();\n    var parser = new DOMParser();\n    var xml = parser.parseFromString(this.xmlString, \"text/xml\");\n    let items = xml.getElementsByTagName(\"item\");\n\n    // firefox and safari should use namespaces in selections, chrome should not\n    let isChrome = /Chrome/.test(navigator.userAgent) && /Google Inc/.test(navigator.vendor);\n    let namespace = (isChrome) ? \"\" : \"wp:\";\n\n    for (let i=0; i<items.length; i++)\n    {\n      let csvItem = [];\n      let item = items[i];\n      let metas = item.getElementsByTagName(namespace + \"postmeta\");\n\n      this.metaKeys.forEach((key)=> {\n        let metaValue = '';\n        for (let j=0; j<metas.length; j++) {\n          let meta = metas[j];\n          let metaKey = meta.getElementsByTagName(namespace + \"meta_key\")[0].childNodes[0].nodeValue;\n\n          if (key[0] == metaKey) {\n            metaValue = meta.getElementsByTagName(namespace + \"meta_value\")[0].childNodes[0].nodeValue;\n          }\n        }\n        csvItem.push('\"' + metaValue + '\"');\n      });\n\n      let attachment = item.getElementsByTagName(namespace + \"attachment_url\")[0];\n      let attachment_url = (!attachment) ? \"\" : attachment.childNodes[0].nodeValue;\n      csvItem.push(attachment_url);\n      if (!this.isDupe(csvItem)) {\n        this.csv.push(csvItem);\n      }\n    }\n\n  }\n\n  isDupe(csvItem) {\n    let dupe = false;\n    this.csv.forEach((item, i) => {\n      // check for first name and last name match\n      if (item[0] == csvItem[0] && item[1] == csvItem[1]) {\n        item[item.length-1] = csvItem[csvItem.length-1]; // use the image (2nd item always has image)\n        dupe = true;\n      }\n    });\n    return dupe;\n  }\n\n  createTitles() {\n    let titles = [];\n    this.metaKeys.forEach((key)=> {\n      titles.push('\"' + key[1] + '\"');\n    });\n    titles.push(\"Photo\");\n    this.csv.push(titles);\n  }\n\n  saveCSV() {\n    var csvContent = \"\";\n\n    this.csv.forEach((infoArray, index)=>{\n      let dataString = infoArray.join(\",\");\n      csvContent += index < this.csv.length ? dataString+ \"\\n\" : dataString;\n    });\n\n    if (navigator.msSaveBlob)\n    { // IE 10+\n      navigator.msSaveBlob(new Blob([csvContent], { type: 'text/csv;charset=utf-8;' }), \"speakers.csv\");\n    } else {\n      var encodedUri = encodeURI(\"data:text/csv;charset=utf-8,\" + csvContent);\n      var link = document.createElement(\"a\");\n      link.setAttribute(\"href\", encodedUri);\n      link.setAttribute(\"download\", \"speakers.csv\");\n      document.body.appendChild(link); // Required for FF\n      link.click();\n    }\n  }\n\n  showOutput() {\n    let $output = $(\"#output\");\n    $output.show();\n    let $content = $output.find(\".content\");\n    $content.empty();\n\n    this.csv.forEach((item, i) => {\n      if (i > 0) {\n        let $item = $('<div class=\"item mt-5 mb-3\"><h3>Speaker</h3></div>');\n        item.forEach((value, n) => {\n          let key = this.csv[0][n].replace(new RegExp('\"', 'g'), \"\");\n          value = value.replace(new RegExp('\"', 'g'), \"\");\n          let $line = $('<p><strong>' + key + ': </strong><span>' + value + '</span></p>');\n          if (n == item.length - 1) {\n            $line = $('<p><strong>' + key + ': </strong></p><div><img style=\"display:block; max-width: 800px;\" src=\"' + value + '\" alt=\"Speaker Photo\" title=\"Speaker Photo\"></div>');\n          }\n          $item.append($line);\n        });\n        $content.append($item);\n      }\n    });\n  }\n}\n\ndocument.addEventListener('DOMContentLoaded', event => new Main());"],"names":["Main","init","csv","metaKeys","initUploadListener","inputElement","document","getElementById","addEventListener","event","handleFiles","e","file","target","files","reader","FileReader","readAsText","onloadend","xmlString","result","createCSV","saveCSV","showOutput","createTitles","parser","DOMParser","xml","parseFromString","items","getElementsByTagName","isChrome","test","navigator","userAgent","vendor","namespace","i","csvItem","item","metas","forEach","key","metaValue","j","length","meta","metaKey","childNodes","nodeValue","push","attachment","attachment_url","isDupe","dupe","titles","csvContent","infoArray","index","dataString","join","msSaveBlob","Blob","type","encodedUri","encodeURI","link","createElement","setAttribute","body","appendChild","click","$output","$","show","$content","find","empty","$item","value","n","replace","RegExp","$line","append"],"mappings":"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"}